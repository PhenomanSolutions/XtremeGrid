!function(t){"use strict";var e={width:400,height:300,headHeight:45,rowHeight:40,columnOptions:!0,columnOptionsWidth:150,checkboxes:!1,checkboxesWidth:50,multiSelect:!1,selectOnRowClick:!1,bodyTextSelectable:!1,copyLocal:!1,cls:!1,selectable:!0,dataSource:!1,data:!1,columns:!1,debug:!1,horizontalScroll:!0,filter:!1,listeners:!1},i=t,s="xtreme",n=s+"-grid",o=s+"GridHead-",h=s+"-grid-head",r=s+"-grid-column-options",l=s+"GridHeadCheckbox-",d=s+"GridBody-",a=s+"GridLeft-",c=s+"GridRight-",p=s+"GridCenter-",u=s+"-grid-body-left",g=s+"-grid-body-right",_=s+"-grid-body-center",v=s+"-grid-row-even",f=s+"-grid-row-odd",y=s+"-grid-row-selected",b=s+"-grid-column-header-arrow",m=s+"-grid-column-header-arrow-active",w=s+"-grid-column-sort-arrow",S=s+"-grid-column-sorted",x=s+"-grid-column-sort-arrow-ascending",k=s+"GridSortArrow-",C=s+"GridHeaderArrow-",D=s+"-grid-column-header-option-checkbox",H=s+"-grid-body",L=s+"-grid-body-scroll-container",O=s+"-grid-body-div-container",W=s+"-grid-body-block",T=s+"-grid-row",E=s+"-grid-cell",$=new i.HtmlTemplate("<div {properties} {styles}>{body}</div>"),A=1,B=2,I=3,N=4,M=5,G=6,P=7,R=function(t,e,s,n){if(s){for(var o=[],h=0;h<e.length;h++)s.call(t,h,e[h],e)&&(o[o.length]=n?e[h]:i.clone(e[h]));return o}return n?e:i.clone(e)},F=function(t){for(var e,s=[],n=0;n<t.length;n++)e=i.clone(t[n]),e._id_=n,s[s.length]=e;return s},j=function(t,s){var n=this;e.width=t.clientWidth,e.height=t.clientHeight,this.options=this.merge(s||{},e),this.container=t,this.id=this.options.id||i.Guid.newGuid(),this.name=this.options.name||this.id,this.data=[],this.dataSource=!1,this._data=[],this._viewData=[],this.blocked=!1,this.columns=[],this.currentPosition=0,this._columns=[],this._selected=[],this._grid=null,this._blockDiv=null,this._head=null,this._body=null,this._left=null,this._center=null,this._right=null,this._vScrollContainer=null,this._vScrollDiv=null,this.debug={},this.ready=!1,i.Register(n,n.name);var o=function(){for(var t=n.$new("ul"),e=n._columns,s=0;s<e.length;s++)if(n.columns[s].options!==!1){var o=n.$new("li");o.className=D;var h=n.$new("input");h.type="checkbox",h.setAttribute("column",s),h.checked=e[s].visible,h.setAttribute("phType",M),h.id=i.Guid.newGuid();var r=n.$new("label");r.setAttribute("for",h.id),r.setAttribute("phType",M),r.innerHTML=n.columns[s].title,r.setAttribute("column",s),o.appendChild(h),o.appendChild(r),t.appendChild(o)}return t};this.headerOptionsMenu=[{name:"Columns",renderer:o}],this.getSelected=function(){for(var t,e=[],i=0;i<this._data;i++)this._selected.indexOf(this._data[i]._id_)>=0&&(t=this._data[i].clone(),t._id_=null,e[e.length]=t);return e},n.init()};j.prototype.changeOptions=function(t){t&&(this._selected.length=0,this.unWatch("_grid"),this.unWatch("_header"),this.unWatch("_body"),this.unWatch("container"),this.container.innerHTML="",this.options=this.merge(t,this.options),this.init(),this.refresh(),this.callListener("optionsChanged",!0,t))},j.prototype.dispose=function(){this._dispose(),this.unWatch("columns"),this.unWatch("_columns"),this.unWatch("data"),this.unWatch("_data"),this.unWatch("_viewData"),this.unWatch("dataSource"),this.unWatch("currentPosition"),this.unWatch("blocked"),this.unWatch("_grid"),this.unWatch("_header"),this.unWatch("_body"),this.unWatch("container"),this._center.children.remove(),this._left.children.remove(),this._right.children.remove(),this._body.children.remove(),this._head.children.remove(),this._grid.children.remove(),this.container.removeChild(this._grid),this.callListener("disposed",!0);for(var t in this)this[t]=null},j.prototype.hideShowColumn=function(t){var e=this,i=0,s=e._columns;if(t<s.length){for(var n=0;n<s.length;n++)s[n].visible&&s[n].options!==!1&&i++;(i>1||2>i&&!s[t].visible)&&(s[t].visible=!s[t].visible,e._columns=s)}},j.prototype.deleteRow=function(t){var e;for(e=0;e<this._data.length;e++)if(this._data[e]._id_==t){this._data.splice(e,1),this.callListener("deleteRow",!0);break}for(e=0;e<this._viewData.length;e++)if(this._viewData[e]._id_==t){this._viewData.splice(e,1);break}this._selected.length=0,this._viewData=this._viewData.length>0?this._viewData:this._data},j.prototype.merge=function(t,e,i){var s={};for(var n in t)s[n]=t[n];for(var o in e)i?s[o]=e[o]:void 0===s[o]&&(s[o]=e[o]);return s},j.prototype.getIdFor=function(t){return t+this.id},j.prototype.$new=function(t){return document.createElement(t)},j.prototype.$id=function(t){return document.getElementById(t)},j.prototype.$own=function(t){return document.getElementById(t+this.id)},j.prototype.init=function(){var t=this;this._blockDiv=this.$new("div"),this._blockDiv.className=W,this._grid=this.$new("div"),this._grid.id=this.id,this._grid.className=n+(this.options.cls?" "+this.options.cls:""),this._grid.style.width=this.options.width+"px",this._grid.style.height=this.options.height+"px",this.container.appendChild(this._grid);var e=this._grid.clientWidth;this._head=this.$new("div"),this._head.id=this.getIdFor(o),this._head.className=h,this._head.style.height=this.options.headHeight+"px",this._head.style.lineHeight=this.options.headHeight+"px",this._head.style.width=e+"px",this._body=this.$new("div"),this._body.id=this.getIdFor(d),this._body.className=H+(this.options.bodyTextSelectable?"":" no-user-select"),this._body.style.height=this.options.height-this.options.headHeight+"px",this._body.style.width=e+"px",this._grid.appendChild(this._head),this._grid.appendChild(this._body);var i=this._body.clientHeight-2,s=this._body.clientWidth,r=this._head.offsetHeight;this._left=this.$new("div"),this._left.id=this.getIdFor(a),this._left.style.height=i+"px",this._left.className=u,this._right=this.$new("div"),this._right.id=this.getIdFor(c),this._right.style.height=i+"px",this._right.className=g,this._center=this.$new("div"),this._center.id=this.getIdFor(p),this._center.style.height=i+"px",this._center.style.width=s+"px",this._center.className=_,this._vScrollContainer=this.$new("div"),this._vScrollContainer.className=L,this._vScrollContainer.style.height=i+"px",this._vScrollContainer.style.top=r+1+"px",this._vScrollContainer.onscroll=function(){t.currentPosition=Math.ceil(this.scrollTop/t.options.rowHeight)},this._vScrollDiv=this.$new("div"),this._vScrollDiv.className=O,this._vScrollContainer.appendChild(this._vScrollDiv),this._body.appendChild(this._left),this._body.appendChild(this._center),this._body.appendChild(this._right),this._grid.appendChild(this._vScrollContainer),this._grid.appendChild(this._blockDiv),this._grid.onscroll=t._onGridScroll,t.setMouseEvents(),t.setWatchers(),t.ready=!0,this.options.columns&&(t.columns=this.options.columns),this.options.data&&(t.data=this.options.data),this.options.dataSource&&(t.dataSource=this.options.dataSource),t.callListener("draw",!0)},j.prototype._onGridScroll=function(){this._vScrollContainer.style.right=this._grid.scrollLeft>0?-1*this._grid.scrollLeft+"px":0},j.prototype.requestData=function(t){var e=this;e.options.debug&&i.DebugSession(e.id).start(),e.blocked=!0,i.Ajax.request(t||e.dataSource).done(function(t){e.options.debug&&(i.DebugSession(e.id).end(),e.debug.ajaxLoad=i.DebugSession(e.id).duration(),e.options.debug.call(e,"ajaxLoad",i.DebugSession(e.id).duration())),e.blocked=!1,e.data=JSON.parse(t)})},j.prototype.isBlocked=function(){return this.blocked},j.prototype._onColumnsSet=function(){this._selected.length=0,this._columns=i.clone(this.columns,!0)},j.prototype._on_ColumnsSet=function(){for(var t=0;t<this.columns.length;t++)void 0===this._columns[t].visible&&(this._columns[t].visible=!0),void 0===this._columns[t].sortable&&(this._columns[t].sortable=!0);this.renderHead(),this.renderBody()},j.prototype._onDataSet=function(){this.options.debug&&i.DebugSession(this.id+"render").start(),this._selected.length=0,this._data=R(this,F(this.data)),this.options.debug&&(i.DebugSession(this.id+"render").end(),this.debug.render=i.DebugSession(this.id+"render").duration(),this.options.debug.call(this,"render",i.DebugSession(this.id+"render").duration()))},j.prototype._on_DataSet=function(){this._viewData=this.options.filter?R(this,this._data,this.options.filter,!0):this._data},j.prototype._onBlockedSet=function(t,e,i){this._blockDiv.style.display=i?"block":"none"},j.prototype._onDataSourceSet=function(){this.requestData()},j.prototype.setWatchers=function(){var t=this;t.readOnly("_grid"),t.readOnly("_header"),t.readOnly("_body"),t.readOnly("container"),t.onChange("columns",!t.isBlocked,t._onColumnsSet),t.onChange("_columns",null,t._on_ColumnsSet),t.onChange("data",!t.isBlocked,t._onDataSet),t.onChange("_data",null,t._on_DataSet),t.onChange("_viewData",null,t.renderBody),t.onChange("dataSource",null,t._onDataSourceSet),t.onChange("currentPosition",null,t.renderBody),t.onChange("blocked",null,t._onBlockedSet)},j.prototype.refresh=function(){this.renderHead(),this.renderBody(),this.callListener("refresh",!0)},j.prototype.selectRow=function(t,e){if(this.options.selectable&&t<this._data.length){e||void 0===e?(this.options.multiSelect||(this._selected.length=0),this._selected.indexOf(t)<0&&(this._selected[this._selected.length]=t,this.callListener("selectRow",!0))):this._selected.splice(this._selected.indexOf(t),1);var i=this.$own(l);i&&(i.checked=this._selected.length===this._viewData.length,i.indeterminate=this._selected.length>0&&!i.checked),this.renderBody()}},j.prototype.toggleRow=function(t){this.options.selectable&&null!=t&&this.selectRow(t,this._selected.indexOf(t)<0)},j.prototype.selectAll=function(t){if(this.options.selectable&&this.options.multiSelect&&!this.blocked){if(t||void 0===t){this._selected.length=0;for(var e=0;e<this._viewData.length;e++)this._selected[this._selected.length]=this._viewData[e]._id_;this.callListener("selectAll",!0)}else this._selected.length=0;var i=this.$own(l);i&&(i.checked=this._selected.length==this._viewData.length),this.renderBody()}},j.prototype.setMouseEvents=function(){var t=this,e=function(e){var i=window.event||e,s=i.srcElement||i.target;if(s){var n=parseInt(s.getAttribute("phType"));if(n==M);else{e.preventDefault();var o=i.wheelDelta||-1*i.detail;t.scroll(o>0)}}return!1},i=function(e){var i=parseInt(e.getAttribute("column"));if(t._columns[i].sortable){t._columns[i].ascending=!t._columns[i].ascending;var s,n=t._columns[i].ascending,o=t.$id(k+t.id+i),h=t.siblings(e);for(s=0;s<h.length;s++)h[s].className.indexOf(S)>=0&&h[s].classList.toggle(S);e.classList.contains(S)||e.classList.add(S),n?o.className.indexOf(x)<0&&o.classList.add(x):o.className.indexOf(x)>=0&&o.classList.toggle(x),t._selected.length=0;var r=t.$own(l);for(r&&(r.checked=!1),s=0;s<t.columns.length;s++)t.columns[s].sorted=s==i;t.blocked=!0,setTimeout(function(){t._data=t.sort(t._data,t.columns[i].data,n),t.blocked=!1},20)}},s=function(e){e.stopPropagation(),e.stopImmediatePropagation(),t.removeColumnOptions();var s=e.srcElement||e.target;if(s){if(t.blocked)return("checkbox"==s.getAttribute("type")||"radio"==s.getAttribute("type"))&&(s.checked=!s.checked),null;var n=parseInt(s.getAttribute("phType"));switch(n){case P:t.toggleRow(parseInt(s.parentElement.getAttribute("_id_")));break;case N:t.options.selectOnRowClick&&t.toggleRow(parseInt(s.parentElement.getAttribute("_id_")));break;case I:i(s);break;case A:t.onColumnOptionsClick(e);break;case B:i(s.parentElement);break;case G:t.blocked?s.checked=!1:t.selectAll(s.checked);break;case M:t.hideShowColumn(parseInt(s.getAttribute("column")))}}};this._body.addEventListener?(this._body.addEventListener("mousewheel",e,!1),this._body.addEventListener("DOMMouseScroll",e,!1)):this._body.attachEvent("onmousewheel",e),this.listen(this._grid,"click",s),this.listen(window,"click",function(e){var i=e.srcElement||e.target;if(i){var s=parseInt(i.getAttribute("phType"));s!=M&&t.removeColumnOptions()}})},j.prototype.visibleRows=function(){return Math.ceil(this._center.clientHeight/this.options.rowHeight)},j.prototype.maxScroll=function(){return this._data.length-Math.ceil(this._center.clientHeight/this.options.rowHeight)+1},j.prototype.scrollTo=function(t){var e=this.maxScroll(),i=0>t?0:t>e?e:t;this.currentPosition=i},j.prototype.scroll=function(t){var e=this.maxScroll();t?this.currentPosition>0&&(this.currentPosition-=1):this.currentPosition<e&&(this.currentPosition+=1)},j.prototype.siblings=function(){var t=function(t,e){for(var i=[];t;t=t.nextSibling)1==t.nodeType&&t!=e&&(i[i.length]=t);return i};return function(e){return t(e.parentNode.firstChild,e)}}(),j.prototype.listen=function(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i},j.prototype.removeListener=function(t,e,i){t.addEventListener?t.removeEventListener(e,i,!1):t.detachEvent?t.detachEvent("on"+e,i):t["on"+e]=null},j.prototype.removeColumnOptions=function(){var t=document.getElementsByClassName(m);if(t.length>0)for(var e=0;e<t.length;e++)t[e].hideOptions&&t[e].hideOptions()},j.prototype.onColumnOptionsClick=function(t){var e=this,i=t.srcElement||t.target;if(i){var s=i.offsetParent.offsetLeft+i.offsetLeft+i.offsetWidth-this._body.offsetLeft,n=e._grid.clientHeight-e._head.offsetHeight-10,o=this.$new("div");o.className=r;for(var h=this.$new("ul"),l=0;l<e.headerOptionsMenu.length;l++){var d=e.headerOptionsMenu[l];if(d.renderer)h.appendChild(d.renderer());else{var a=this.$new("li");a.innerHTML=e.headerOptionsMenu[l].name,h.appendChild(a)}}o.appendChild(h),e._body.appendChild(o),o.offsetHeight>=n&&(o.style.height=n+"px");var c=o.offsetWidth,p=s-c+1;0>p&&(p+=c-i.offsetWidth-1),o.style.width=c+"px",o.style.left=p+"px",i.classList.add(m),i.hideOptions=function(){i.className.indexOf(m)>=0&&i.classList.toggle(m),o.remove()}}return!1},j.prototype.renderHead=function(){if(this.ready){this.removeColumnOptions();var t=this.columns,e=this._columns;if(t.length>0){var i,s=0;for(i=0;i<e.length;i++)e[i].visible&&s++;var n=this.options.checkboxes&&this.options.selectable?this.options.checkboxesWidth:0,o=0;for(i=0;i<e.length;i++)e[i].visible&&(void 0!=t[i].width?n+=t[i].width:o++);var h=this._grid.clientWidth-n;0>h&&(h=0),this.options.horizontalScroll&&o>0&&40*o>h&&(h=40*o);var r=n+h;this._head.style.width=r+"px";var d=h/o;for(i=0;i<e.length;i++)e[i].visible&&void 0===t[i].width&&(e[i].width=d);var a="",c="",p="",u=this._head.clientHeight+"px";for(this.options.checkboxes&&this.options.selectable&&(a+=$.replace({body:this.options.multiSelect?'<input type="checkbox" id="'+this.getIdFor(l)+'" phType="'+G+'" />':"",properties:{column:"-1","class":E+" alignment-center"},styles:{width:this.options.checkboxesWidth+"px",height:u}},!0)),i=0;i<e.length;i++)c="",e[i].visible&&(this.options.columnOptions&&e[i].options!==!1&&(c=$.replace({properties:{id:C+i,"class":b,phType:A,column:i}},!0)),p=$.replace({properties:{column:i,phType:B,id:k+this.id+i,"class":w}},!0),a+=$.replace({body:e[i].title+p+c,properties:{column:i,phType:I,"class":E+(i==e.length-1?" "+E+"-last":"")+" alignment-"+(e[i].align?" alignment-"+e[i].align:"left")+(e[i].sorted?" "+S:"")},styles:{width:e[i].width+"px",height:u}},!0));this._head.innerHTML=$.replace({body:a,properties:{"class":T}},!0)}}},j.prototype.renderVScroll=function(){this._body.style.height=this._grid.clientHeight-this._head.offsetHeight+"px",this._left.style.height=this._body.style.height,this._center.style.height=this._body.style.height,this._right.style.height=this._body.style.height,this._vScrollDiv.style.height=this._viewData.length*this.options.rowHeight+"px",this._vScrollContainer.scrollTop=this.currentPosition*this.options.rowHeight,this._vScrollContainer.style.height=this._body.style.height},j.prototype.Filter=function(t){var e=t||this.options.filter;this._viewData=R(this,this._data,e,!0)},j.prototype.callListener=function(t,e,i){var s=this;s.options.listeners&&s.options.listeners[t]&&(e?setTimeout(function(){s.options.listeners[t].call(s,i)},10):s.options.listeners[t].call(s,i))},j.prototype.renderBody=function(){if(this.ready){this.options.debug&&i.DebugSession(this.id).start();var t=this._viewData,e=this._columns,s=this.currentPosition;if(e.length>0){var n=this.$own(l);n&&(n.checked=this._selected.length>0&&this._selected.length===this._data.length,n.indeterminate=this._selected.length>0&&!n.checked),this.renderVScroll();var o,h=[],r=0;for(o=0;o<e.length;o++)e[o].visible&&(h[h.length]=e[o],r++);e=h;var d=this._center.clientHeight/this.options.rowHeight;d>t.length&&(d=t.length);var a=parseInt(d),c=d>a&&this.currentPosition==this.maxScroll();c&&(s-=1),this._body.style.width=this._head.style.width,this._center.style.width=this._head.style.width;var p,u,g,_,b,m="",w="";for(o=0;d>o;o++){for(u=o+s,w="",this.options.checkboxes&&this.options.selectable&&(w+=$.replace({body:'<input type="checkbox" '+(this._selected.indexOf(t[u]._id_)>=0?"checked='checked'":"")+' phType="'+P+'" row="'+u+'" />',properties:{"class":E+" alignment-center",_id_:t[u]._id_},styles:{width:this.options.checkboxesWidth+"px",height:this.options.rowHeight+"px"}},!0)),_=0;_<e.length;_++)t[u]instanceof Array?b=t[u][_]:(p=e[_].data,b=t[u][p]),w+=$.replace({body:e[_].renderer?e[_].renderer(b,u,t[u]._id_,t[u],t):b,properties:{column:_,phType:N,"class":E+(_==e.length-1?" "+E+"-last":""),_id_:t[u]._id_},styles:{width:e[_].width+"px",height:this.options.rowHeight+"px"}},!0);g=this._selected.indexOf(t[u]._id_)>=0,m+=$.replace({body:w,properties:{row:u,_id_:t[u]._id_,selected:g,"class":T+" "+(u%2==0?v:f)+(a==d&&o==a-1||d>a&&o==a?" "+T+"-last":"")+(g?" "+y:"")},styles:{height:this.options.rowHeight+"px","line-height":this.options.rowHeight+"px"}},!0)}var S="0px";c&&(S=d%a,S=(1-S)*this.options.rowHeight+1,S*=-1,S+="px"),this._center.style.marginTop=S,this._center.innerHTML=m,this.renderVScroll(),this.callListener("afterRender",!0,{msg:"rendered"})}this.options.debug&&(i.DebugSession(this.id).end(),this.debug.renderBody=i.DebugSession(this.id).duration(),this.options.debug.call(this,"renderBody",i.DebugSession(this.id).duration()))}},j.prototype.sort=function(t,e,i){var s=function(t){return function(e,i){return i[t]<e[t]?1:i[t]>e[t]?-1:0}},n=function(t){return function(e,i){return i[t]<e[t]?-1:i[t]>e[t]?1:0}};return t.sort(i?n(e):s(e))},i.Define("Grid",j)}(window.Xtreme);